# Nombre del workflow
name: Deploy Prototipo to GitHub Pages

# Disparador (Trigger)
# Esto le dice a GitHub que ejecute esta pipeline CADA VEZ que
# haces un 'push' a la rama 'main'.
on:
  push:
    branches:
      - main  # <-- IMPORTANTE: Cambia 'main' si tu rama principal se llama 'master' o 'dev'

# Permisos
# Se necesitan permisos para escribir en la rama de 'gh-pages' (el despliegue)
# y para manejar el token de identidad.
permissions:
  contents: read
  pages: write      # Necesario para desplegar en GitHub Pages
  id-token: write   # Necesario para la autenticación de la acción

# Trabajos (Jobs)
# Este workflow tiene dos trabajos: 'build' y 'deploy'.
# 'deploy' no se ejecutará si 'build' falla.
jobs:
  # --- TRABAJO 1: Construir la Aplicación ---
  build:
    runs-on: ubuntu-latest  # Usar una máquina virtual de Ubuntu
    
    steps:
      # 1. Clonar el repositorio
      # Trae tu código a la máquina virtual
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Configurar Node.js
      # (Si no usas Node.js, omite este paso y el siguiente)
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # <-- Puedes cambiar esto a 18, 20, etc.
          cache: 'npm'       # Habilitar caché para 'npm'

      # 3. Instalar dependencias
      # (Si usas 'yarn', cambia esto a 'yarn install')
      - name: Install dependencies
        run: npm ci  # 'npm ci' es más rápido y seguro para pipelines que 'npm install'

      # 4. Construir (Renderizar) la App
      # Este es el paso clave. Ejecuta el script de "build" de tu package.json
      - name: Build application
        run: npm run build # <-- ¡VITAL! Asegúrate de que este sea tu script de build.
                          # (Podría ser 'npm run build:prod' o similar)

      # 5. Subir el artefacto
      # Sube los archivos estáticos (de la carpeta 'dist') para que
      # el trabajo 'deploy' pueda usarlos.
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          # ¡VITAL! Esta debe ser la carpeta que genera tu 'npm run build'.
          # Las comunes son 'dist', 'build', 'out', o a veces solo './'
          path: './dist' # <-- CAMBIA ESTO si tu app genera la build en otra carpeta

  # --- TRABAJO 2: Desplegar en GitHub Pages ---
  deploy:
    # 'needs: build' asegura que este trabajo solo se ejecute si 'build' terminó bien
    needs: build
    
    # Permisos específicos para este trabajo
    permissions:
      pages: write      # Para escribir en GitHub Pages
      id-token: write   # Para autenticarse
      
    # Configuración del entorno de despliegue
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }} # Guardará la URL del sitio
      
    runs-on: ubuntu-latest
    
    steps:
      # 1. El paso de despliegue
      # Esta acción oficial toma el artefacto subido por 'build'
      # y lo publica en GitHub Pages.
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
